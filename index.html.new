<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Ledger">
<meta name="theme-color" content="#FAFAF9">
<title>School Ledger</title>
<link rel="manifest" href="./manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCHOOL LEDGER â€” Design System v2
   Paleta: Warm Neutral Â· Tipografia: Inter
   Estilo: Profissional, limpo, legÃ­vel
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ TOKENS â”€â”€ */
:root {
  /* Backgrounds â€” warm off-white, not cold gray */
  --bg:         #FAFAF9;      /* pÃ¡gina */
  --bg-2:       #F5F4F2;      /* seÃ§Ãµes agrupadas */
  --card:       #FFFFFF;      /* cartÃµes */
  --card-2:     #FDFCFB;      /* cartÃ£o secundÃ¡rio */

  /* Borders */
  --sep:        rgba(0,0,0,.10);
  --sep-light:  rgba(0,0,0,.06);

  /* Fill */
  --fill:       rgba(0,0,0,.055);
  --fill-2:     rgba(0,0,0,.035);

  /* Brand â€” azul Ã­ndigo sereno, nÃ£o elÃ©trico */
  --accent:     #3B5BDB;
  --accent-l:   rgba(59,91,219,.10);
  --accent-2:   #2F4AC0;

  /* SemÃ¢nticas */
  --green:      #2E7D55;
  --green-l:    rgba(46,125,85,.10);
  --red:        #C0392B;
  --red-l:      rgba(192,57,43,.10);
  --orange:     #C05C1A;
  --orange-l:   rgba(192,92,26,.10);
  --amber:      #B7791F;
  --amber-l:    rgba(183,121,31,.10);
  --purple:     #6B4FBB;
  --purple-l:   rgba(107,79,187,.10);
  --teal:       #1A7F7A;
  --teal-l:     rgba(26,127,122,.10);

  /* Texto â€” escala natural */
  --t-primary:  #18181B;      /* tÃ­tulos, valores */
  --t-body:     #3F3F46;      /* corpo de texto */
  --t-muted:    #71717A;      /* labels, metadados */
  --t-faint:    #A1A1AA;      /* placeholders, hints */
  --t-disabled: #D4D4D8;

  /* Tipografia */
  --f: 'Inter', -apple-system, 'Helvetica Neue', sans-serif;
  --f-mono: 'SF Mono', 'Menlo', 'Consolas', monospace;

  /* Layout */
  --sat: env(safe-area-inset-top, 44px);
  --sab: env(safe-area-inset-bottom, 34px);
  --r:   10px;
  --r2:  14px;
  --r3:  18px;
  --tab: 49px;

  /* Sombras â€” sutis e quentes */
  --s0: 0 1px 2px rgba(0,0,0,.04);
  --s1: 0 1px 3px rgba(0,0,0,.06), 0 1px 8px rgba(0,0,0,.04);
  --s2: 0 2px 8px rgba(0,0,0,.08), 0 1px 3px rgba(0,0,0,.05);
}

/* â”€â”€ RESET â”€â”€ */
*, *::before, *::after {
  box-sizing: border-box; margin: 0; padding: 0;
  -webkit-tap-highlight-color: transparent;
}
html { height: 100%; overscroll-behavior: none; }
body {
  font-family: var(--f);
  font-size: 16px;
  line-height: 1.5;
  background: var(--bg);
  color: var(--t-primary);
  height: 100%;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
  padding-top: var(--sat);
  letter-spacing: -.01em;
}

/* â”€â”€ SCAFFOLD â”€â”€ */
#app { display: flex; flex-direction: column; height: 100%; }
.scroller {
  flex: 1; overflow-y: auto; overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  padding-bottom: calc(var(--tab) + var(--sab) + 20px);
}
.scroller::-webkit-scrollbar { display: none; }

/* â”€â”€ NAV BAR â”€â”€ */
.navbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 11px 20px; flex-shrink: 0; min-height: 48px;
  background: rgba(250,250,249,.95);
  backdrop-filter: saturate(180%) blur(24px);
  -webkit-backdrop-filter: saturate(180%) blur(24px);
  border-bottom: 1px solid var(--sep-light);
}
.navbar-title {
  font-size: 16px;
  font-weight: 600;
  letter-spacing: -.02em;
  color: var(--t-primary);
}

/* Year badge */
.yr-badge {
  display: flex; align-items: center;
  background: var(--accent); border-radius: 100px;
  padding: 5px 12px 5px 14px; cursor: pointer;
  gap: 2px;
}
.yr-badge select {
  appearance: none; background: none; border: none; outline: none;
  font: 600 14px/1 var(--f); color: #fff; cursor: pointer;
  letter-spacing: .01em;
}
.yr-badge select option { background: #fff; color: var(--t-primary); }
.yr-badge::after {
  content: 'â–¾'; color: rgba(255,255,255,.7); font-size: 11px; pointer-events: none;
}

/* â”€â”€ LARGE TITLE â”€â”€ */
.pg-title {
  font-size: 30px;
  font-weight: 700;
  letter-spacing: -.04em;
  color: var(--t-primary);
  padding: 18px 20px 2px;
  line-height: 1.1;
}

/* â”€â”€ PAGES â”€â”€ */
.page { display: none; }
.page.on { display: block; animation: pgfade .18s ease; }
@keyframes pgfade { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

/* â”€â”€ TAB BAR â”€â”€ */
.tabbar {
  position: fixed; bottom: 0; left: 0; right: 0;
  height: calc(var(--tab) + var(--sab));
  padding-bottom: var(--sab);
  background: rgba(250,250,249,.96);
  backdrop-filter: saturate(180%) blur(24px);
  -webkit-backdrop-filter: saturate(180%) blur(24px);
  border-top: 1px solid var(--sep-light);
  display: flex; z-index: 100;
}
.tab {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 3px; padding-top: 5px;
  cursor: pointer; border: none; background: none;
  font: 500 9.5px/1 var(--f);
  color: var(--t-faint);
  letter-spacing: .02em;
  text-transform: uppercase;
  transition: color .15s;
}
.tab.on { color: var(--accent); }
.tab svg { width: 24px; height: 24px; }

/* â”€â”€ KPI ROW â”€â”€ */
.kpi-row {
  display: flex; gap: 10px; overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding: 16px 20px 4px; scrollbar-width: none;
}
.kpi-row::-webkit-scrollbar { display: none; }
.kpi {
  min-width: 150px; flex-shrink: 0; background: var(--card);
  border-radius: var(--r2); padding: 15px 16px;
  box-shadow: var(--s1); border: 1px solid var(--sep-light);
}
.kpi-label {
  font-size: 10.5px; font-weight: 500;
  color: var(--t-muted); margin-bottom: 7px;
  text-transform: uppercase; letter-spacing: .06em;
}
.kpi-value {
  font: 600 21px/1 var(--f-mono);
  letter-spacing: -.02em;
}
.kpi-sub {
  font-size: 11px; color: var(--t-faint);
  margin-top: 5px; line-height: 1.4;
  font-weight: 400;
}
.kpi.blue   .kpi-value { color: var(--accent); }
.kpi.green  .kpi-value { color: var(--green); }
.kpi.red    .kpi-value { color: var(--red); }
.kpi.ora    .kpi-value { color: var(--orange); }
.kpi.purple .kpi-value { color: var(--purple); }


/* â”€â”€ SECTION HEADER â”€â”€ */
.s-hdr {
  display: flex; align-items: baseline;
  justify-content: space-between;
  padding: 22px 20px 10px;
}
.s-title {
  font-size: 18px; font-weight: 700;
  letter-spacing: -.03em; color: var(--t-primary);
}
.s-link {
  font-size: 14px; color: var(--accent);
  cursor: pointer; font-weight: 500;
}

/* â”€â”€ CARD â”€â”€ */
.card {
  background: var(--card); border-radius: var(--r2);
  margin: 0 20px; box-shadow: var(--s1);
  overflow: hidden; border: 1px solid var(--sep-light);
}
.card + .card { margin-top: 12px; }

/* â”€â”€ INSET LIST â”€â”€ */
.list-row {
  display: flex; align-items: center; gap: 14px;
  padding: 12px 16px; border-bottom: 1px solid var(--sep-light);
  min-height: 48px; cursor: pointer;
  transition: background .12s;
}
.list-row:last-child { border-bottom: none; }
.list-row:active { background: var(--fill-2); }
.list-icon {
  width: 32px; height: 32px; border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px; flex-shrink: 0;
}
.list-label { font-size: 15px; font-weight: 400; flex: 1; color: var(--t-body); }
.list-value { font-size: 14px; color: var(--t-muted); font-weight: 400; }
.list-chevron { color: var(--t-disabled); flex-shrink: 0; }
.list-chevron svg { width: 12px; height: 12px; }

/* â”€â”€ TX ROW â”€â”€ */
.tx-icon {
  width: 38px; height: 38px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 17px; flex-shrink: 0;
}
.tx-main { font-size: 15px; font-weight: 500; color: var(--t-primary); }
.tx-sub  { font-size: 12px; color: var(--t-muted); margin-top: 2px; line-height: 1.4; }
.tx-amount {
  font: 600 15px/1 var(--f-mono);
  letter-spacing: -.02em;
}
.tx-amount.out { color: var(--red); }
.tx-amount.in  { color: var(--green); }
.tx-late {
  font-size: 10px; color: var(--red);
  font-weight: 600; margin-top: 3px;
  letter-spacing: .02em;
}

/* â”€â”€ CHART â”€â”€ */
.chart-title {
  font-size: 11px; font-weight: 600;
  color: var(--t-muted); text-transform: uppercase;
  letter-spacing: .07em; margin-bottom: 16px;
}
.donut-pair  { display: flex; gap: 12px; }
.donut-col   { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; }
.donut-name  { font-size: 11px; font-weight: 500; color: var(--t-muted); letter-spacing: .02em; }
.legend      { width: 100%; display: flex; flex-direction: column; gap: 5px; }
.leg-item    { display: flex; align-items: center; gap: 7px; font-size: 10.5px; color: var(--t-muted); }
.leg-swatch  { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }
.leg-pct     { font: 500 10px/1 var(--f-mono); margin-left: auto; color: var(--t-primary); }

/* â”€â”€ FORM â”€â”€ */
.form-section  { margin: 20px 20px 0; }
.form-label {
  font-size: 11px; font-weight: 600; color: var(--t-muted);
  text-transform: uppercase; letter-spacing: .07em;
  margin-bottom: 7px; padding: 0 2px;
}
.form-card {
  background: var(--card); border-radius: var(--r2);
  overflow: hidden; box-shadow: var(--s1);
  border: 1px solid var(--sep-light);
}
.field {
  display: flex; align-items: center; gap: 12px;
  padding: 0 16px; border-bottom: 1px solid var(--sep-light);
  min-height: 46px;
}
.field:last-child { border-bottom: none; }
.field-label {
  font-size: 15px; font-weight: 400; min-width: 100px;
  flex-shrink: 0; color: var(--t-body);
}
.field input, .field select, .field textarea {
  flex: 1; border: none; background: none; outline: none;
  font: 400 15px/1 var(--f); color: var(--t-primary);
  text-align: right; -webkit-appearance: none;
  letter-spacing: -.01em;
}
.field input::placeholder { color: var(--t-disabled); }
.field select option { text-align: left; }
.field.tall { align-items: flex-start; padding: 12px 16px; }
.field.tall .field-label {
  font-size: 13px; color: var(--t-muted);
  font-weight: 500; padding-top: 2px; min-width: auto;
}
.field.tall textarea {
  text-align: left; resize: none; line-height: 1.5;
  padding: 0; font-size: 14px;
}

/* Toggle field */
.tog-field {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px; border-bottom: 1px solid var(--sep-light);
  min-height: 46px; cursor: pointer;
}
.tog-label { font-size: 15px; font-weight: 400; color: var(--t-body); }
.toggle {
  width: 51px; height: 31px; border-radius: 16px;
  background: var(--t-disabled); position: relative;
  flex-shrink: 0; transition: background .2s; cursor: pointer;
}
.toggle.on { background: var(--green); }
.toggle::after {
  content: ''; position: absolute;
  left: 2px; top: 2px; width: 27px; height: 27px;
  border-radius: 50%; background: #fff;
  box-shadow: 0 2px 5px rgba(0,0,0,.2);
  transition: transform .22s cubic-bezier(.34,1.12,.64,1);
}
.toggle.on::after { transform: translateX(20px); }

/* â”€â”€ BUTTONS â”€â”€ */
.btn {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  width: 100%; padding: 14px 20px; border-radius: var(--r2);
  font: 600 15px/1 var(--f); border: none; cursor: pointer;
  letter-spacing: -.01em; transition: opacity .15s, transform .1s;
}
.btn:active { opacity: .8; transform: scale(.99); }
.btn.primary     { background: var(--accent); color: #fff; }
.btn.destructive { background: var(--red-l); color: var(--red); }
.btn.secondary   { background: var(--fill); color: var(--t-body); }
.btn.green-btn   { background: var(--green); color: #fff; }
.btns { display: flex; flex-direction: column; gap: 10px; padding: 18px 20px 4px; }

/* Pill button */
.pill-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px; border-radius: 100px;
  font: 500 14px/1 var(--f); border: none; cursor: pointer;
  letter-spacing: -.01em; transition: opacity .15s;
  white-space: nowrap;
}
.pill-btn:active  { opacity: .75; }
.pill-btn:disabled { opacity: .35; cursor: default; }
.pill-btn.blue  { background: var(--accent); color: #fff; }
.pill-btn.gray  { background: var(--fill); color: var(--t-body); }
.pill-btn.green { background: var(--green); color: #fff; }

/* â”€â”€ AI SECTION â”€â”€ */
.ai-drop {
  border: 1.5px dashed var(--sep); border-radius: var(--r);
  background: var(--bg-2); padding: 22px 16px; text-align: center;
  cursor: pointer; transition: all .2s; margin-bottom: 12px;
}
.ai-drop.hover  { border-color: var(--accent); background: var(--accent-l); }
.ai-drop.filled { border-style: solid; border-color: var(--green); background: var(--green-l); }

.api-key-row { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
.api-key-input {
  flex: 1; background: var(--bg-2);
  border: 1px solid var(--sep); border-radius: var(--r);
  padding: 10px 12px; font: 400 13px/1 var(--f-mono);
  color: var(--t-primary); outline: none; -webkit-appearance: none;
  letter-spacing: .02em;
}
.api-key-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-l); }

.ai-result {
  display: none; background: var(--green-l);
  border: 1px solid rgba(46,125,85,.25);
  border-radius: var(--r); padding: 12px 14px; margin-top: 12px;
}
@keyframes aiFlash { 0% { background: rgba(46,125,85,.12); } 100% { background: transparent; } }
.ai-hi { animation: aiFlash 2.5s ease forwards; }

/* â”€â”€ REPORTS â”€â”€ */
.rpt-year-card {
  background: var(--card); border-radius: var(--r2);
  margin: 0 20px 14px; overflow: hidden;
  box-shadow: var(--s1); border: 1px solid var(--sep-light);
}
.rpt-year-hdr {
  background: var(--accent); color: #fff;
  padding: 14px 18px; display: flex;
  justify-content: space-between; align-items: center;
}
.rpt-year-hdr h3 { font-size: 16px; font-weight: 700; letter-spacing: -.02em; }
.rpt-year-hdr span { font: 500 13px/1 var(--f-mono); opacity: .8; }
.rpt-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }

.rpt-tbl, .rtbl {
  width: 100%; border-collapse: collapse; white-space: nowrap;
}
.rpt-tbl th, .rtbl th {
  padding: 9px 14px; text-align: right;
  font-size: 10px; font-weight: 600;
  color: var(--t-muted); text-transform: uppercase;
  letter-spacing: .06em; background: var(--bg-2);
  border-bottom: 1px solid var(--sep-light);
}
.rpt-tbl th:first-child, .rtbl th:first-child { text-align: left; padding-left: 16px; }
.rpt-tbl td, .rtbl td {
  padding: 10px 14px; text-align: right;
  border-bottom: 1px solid var(--sep-light);
  font: 400 12px/1 var(--f-mono); color: var(--t-muted);
  letter-spacing: -.01em;
}
.rpt-tbl td:first-child, .rtbl td:first-child {
  text-align: left; font: 500 13px/1 var(--f);
  color: var(--t-body); padding-left: 16px;
  letter-spacing: -.01em;
}
.rpt-tbl tr:last-child td, .rtbl tr:last-child td { border-bottom: none; }
.rpt-tbl tr.total-row td, .rtbl tr.total-row td {
  background: rgba(59,91,219,.05); font-weight: 700;
  color: var(--t-primary); border-top: 1px solid rgba(59,91,219,.18);
}

/* Report utility classes */
.r         { text-align: right !important; }
.neg       { color: var(--red) !important; }
.recv      { color: var(--green) !important; }
.pct-ok    { color: var(--green) !important; font-weight: 600; }
.late-sym  { color: var(--red); }

/* Grand total strip */
.grand-total {
  background: var(--accent); border-radius: var(--r2);
  margin: 0 20px 14px; padding: 18px 16px;
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
  box-shadow: var(--s2);
}
.gt-row {
  background: var(--accent); border-radius: var(--r2);
  margin: 0 20px 14px; padding: 18px 16px;
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
  box-shadow: var(--s2);
}
.gt-item, .gt-cell { text-align: center; }
.gt-label {
  font-size: 9.5px; font-weight: 600;
  color: rgba(255,255,255,.6); text-transform: uppercase;
  letter-spacing: .07em; margin-bottom: 5px;
}
.gt-value {
  font: 600 16px/1 var(--f-mono);
  color: #fff; letter-spacing: -.02em;
}
.gt-value.warn   { color: #FBBF24; }
.gt-value.danger { color: #FCA5A5; }

/* â”€â”€ BOTTOM SHEET â”€â”€ */
.sheet-bg {
  position: fixed; inset: 0; background: rgba(0,0,0,.35);
  z-index: 400; display: none; align-items: flex-end;
}
.sheet-bg.open { display: flex; animation: bgfade .2s ease; }
@keyframes bgfade { from { opacity: 0; } to { opacity: 1; } }
.sheet {
  background: var(--card); border-radius: 18px 18px 0 0;
  width: 100%; max-height: 92vh; overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 0 0 calc(var(--sab) + 8px);
  animation: sheetup .3s cubic-bezier(.34,1.12,.64,1);
  border-top: 1px solid var(--sep-light);
}
@keyframes sheetup { from { transform: translateY(100%); } to { transform: translateY(0); } }
.sheet-grip {
  width: 36px; height: 4px; background: var(--sep);
  border-radius: 2px; margin: 10px auto 0;
}
.sheet-hdr {
  padding: 14px 20px 13px;
  border-bottom: 1px solid var(--sep-light);
  display: flex; align-items: center; justify-content: space-between;
}
.sheet-title { font-size: 17px; font-weight: 600; letter-spacing: -.02em; }
.sheet-close {
  font-size: 15px; color: var(--accent); background: none;
  border: none; font-family: var(--f); cursor: pointer;
  font-weight: 500; padding: 0;
}

/* â”€â”€ SPINNER â”€â”€ */
@keyframes spin { to { transform: rotate(360deg); } }
.spinner {
  width: 20px; height: 20px;
  border: 2px solid var(--sep-light);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin .5s linear infinite;
  display: inline-block; vertical-align: middle;
}

/* â”€â”€ TOAST â”€â”€ */
.toast {
  position: fixed;
  bottom: calc(var(--tab) + var(--sab) + 14px);
  left: 50%; transform: translateX(-50%);
  background: rgba(24,24,27,.9);
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  border-radius: 100px; padding: 11px 22px;
  font: 500 13.5px/1 var(--f); color: #fff;
  white-space: nowrap; z-index: 999;
  opacity: 0; transition: opacity .2s;
  pointer-events: none; letter-spacing: -.01em;
  box-shadow: var(--s2);
}
.toast.on { opacity: 1; }

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 56px 24px; gap: 10px;
}
.empty-icon { font-size: 44px; }
.empty-text { font-size: 15px; color: var(--t-muted); text-align: center; font-weight: 400; }

/* category inline */
.list-body { flex: 1; min-width: 0; }
.list-name { font-size: 15px; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--t-body); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT / PDF
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media print {
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
  html, body {
    height: auto !important; overflow: visible !important;
    background: #fff !important; padding: 0 !important; font-size: 10pt;
  }
  #app { display: block !important; height: auto !important; overflow: visible !important; }
  .scroller { overflow: visible !important; height: auto !important; padding: 0 !important; }
  .navbar, .tabbar, .sheet-bg, #rpt-actions-bar,
  .page:not(#page-rpt) { display: none !important; }
  #page-rpt { display: block !important; }
  .pg-title { font-size: 22pt; padding: 0 0 8pt; }
  .rpt-year-card, .rpt-card {
    margin: 0 0 12pt; break-inside: avoid;
    box-shadow: none !important; border: 1px solid #ccc;
    border-radius: 6pt;
  }
  .rpt-year-hdr { background: #3B5BDB !important; padding: 9pt 12pt; }
  .rpt-year-hdr h3, .rpt-year-hdr span { color: #fff !important; }
  .rpt-yr-hdr { background: #3B5BDB !important; padding: 9pt 12pt; border-radius: 0; }
  .rpt-yr-hdr h3, .rpt-yr-hdr span { color: #fff !important; }
  .rtbl th { background: #f4f4f5 !important; font-size: 8pt; padding: 5pt 9pt; }
  .rtbl td { font-size: 8.5pt; padding: 6pt 9pt; }
  .rtbl tr.total-row td { background: rgba(59,91,219,.07) !important; }
  .rpt-table-wrap { overflow: visible !important; }
  .gt-row, .grand-total { background: #3B5BDB !important; margin: 0 0 12pt; break-inside: avoid; border-radius: 6pt; padding: 12pt; }
  #rpt-content { padding: 0 !important; }
  #rpt-actions-bar { display: none !important; }
  #rpt-hint { font-size: 8pt; color: #666; }
  @page { margin: 14mm 12mm; }
}
</style>
</head>
<body>
<div id="app">

  <!-- NAV BAR -->
  <div class="navbar" id="navbar">
    <div class="navbar-title" id="nav-title">InÃ­cio</div>
    <div id="nav-yr" class="yr-badge"><select id="yr-sel"></select></div>
  </div>

  <!-- SCROLL AREA -->
  <div class="scroller" id="scroller">

    <!-- â–‘â–‘ DASHBOARD â–‘â–‘ -->
    <div class="page on" id="page-dash">
      <div class="pg-title">Dashboard</div>
      <div class="kpi-row" id="kpi-row"></div>
      <div id="chart-area" style="margin-top:12px"></div>
      <div class="s-hdr"><span class="s-title">Recentes</span><span class="s-link" onclick="nav('txs')">Ver todas â†’</span></div>
      <div class="card" id="recent-card"><div class="empty-state"><span class="spinner"></span></div></div>
      <div style="height:8px"></div>
    </div>

    <!-- â–‘â–‘ TRANSACTIONS â–‘â–‘ -->
    <div class="page" id="page-txs">
      <div class="pg-title">TransaÃ§Ãµes</div>
      <div style="display:flex;gap:8px;padding:12px 20px 4px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none">
        <select id="fil-type" onchange="renderTxList()" style="background:var(--card);border:1px solid var(--sep-light);border-radius:100px;padding:7px 16px;font:500 13px/1 var(--f);color:var(--t-body);outline:none;-webkit-appearance:none;flex-shrink:0;cursor:pointer;box-shadow:var(--s0);letter-spacing:-.01em">
          <option value="">Todos os tipos</option>
          <option value="PAID">Pago</option>
          <option value="RECEIVED">Recebido</option>
        </select>
        <select id="fil-cat" onchange="renderTxList()" style="background:var(--card);border:1px solid var(--sep-light);border-radius:100px;padding:7px 16px;font:500 13px/1 var(--f);color:var(--t-body);outline:none;-webkit-appearance:none;flex-shrink:0;cursor:pointer;box-shadow:var(--s0);letter-spacing:-.01em">
          <option value="">Todas categorias</option>
        </select>
      </div>
      <div id="tx-wrap" style="margin:4px 0"></div>
    </div>

    <!-- â–‘â–‘ ADD / EDIT â–‘â–‘ -->
    <div class="page" id="page-add">
      <div class="pg-title" id="add-title">Nova TransaÃ§Ã£o</div>

      <!-- AI: API KEY + FILE -->
      <div class="form-section">
        <div class="form-label">âœ¦ Preencher com IA (gratuita/offline)</div>
        <div class="form-card" style="padding:14px 16px">
<div class="api-key-row">
              <input class="api-key-input" id="api-key" type="password" autocomplete="off" spellcheck="false" placeholder="sk-ant-api03-â€¦">
              <button class="pill-btn gray" onclick="toggleKeyVis()" style="padding:10px 14px;font-size:13px">ğŸ‘</button>
            </div>
            <p style="font-size:11px;color:var(--t-faint);line-height:1.6;margin-top:6px">
              Obtenha em <strong>console.anthropic.com</strong> â†’ API Keys.<br>
              A chave Ã© salva no iPhone e nunca compartilhada.
            </p>
          </div>

          <div id="ai-drop" class="ai-drop" onclick="document.getElementById('ai-file').click()">
            <input type="file" id="ai-file" accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="loadAiFile(event.target.files[0])">
            <div id="ai-idle">
              <div style="font-size:30px;margin-bottom:6px">ğŸ“„</div>
              <div style="font-size:14px;font-weight:500;color:var(--t-body)">Toque para escolher arquivo</div>
              <div style="font-size:12px;color:var(--t-muted);margin-top:3px">Boleto Â· Comprovante Â· PDF Â· Imagem</div>
            </div>
            <div id="ai-file-info" style="display:none;align-items:center;gap:12px">
              <span id="ai-file-ic" style="font-size:28px"></span>
              <div style="flex:1;text-align:left;min-width:0">
                <div id="ai-file-nm" style="font-size:14px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></div>
                <div id="ai-file-sz" style="font-size:12px;color:var(--t-muted);margin-top:2px"></div>
              </div>
              <button onclick="clearAiFile(event)" style="background:var(--fill);border:none;border-radius:100px;padding:6px 12px;font:500 13px/1 var(--f);color:var(--t-body);cursor:pointer;flex-shrink:0">Remover</button>
            </div>
          </div>

          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
            <button id="ai-run-btn" class="pill-btn blue" disabled onclick="runAI()">
              <span id="ai-run-ic">âœ¦</span>&nbsp;<span id="ai-run-txt">Interpretar com IA (offline)</span>
            </button>
            <span id="ai-status" style="font-size:12px;color:var(--t-muted)"></span>
          </div>

          <div class="ai-result" id="ai-result">
            <div style="display:flex;gap:10px">
              <span style="font-size:20px">âœ…</span>
              <div>
                <div style="font-size:13px;font-weight:600;color:var(--green);margin-bottom:3px">Campos preenchidos</div>
                <div id="ai-summary" style="font-size:12px;color:var(--t-body);line-height:1.5"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- FORM FIELDS -->
      <div class="form-section" style="margin-top:20px">
        <div class="form-label">Dados</div>
        <div class="form-card" id="form-fields">
          <input type="hidden" id="f-id">
          <div class="field">
            <span class="field-label">Valor (R$)</span>
            <input id="f-val" type="number" inputmode="decimal" step="0.01" placeholder="0,00">
          </div>
          <div class="field">
            <span class="field-label">Tipo</span>
            <select id="f-type">
              <option value="PAID">SaÃ­da (pago)</option>
              <option value="RECEIVED">Entrada (recebido)</option>
            </select>
          </div>
          <div class="field">
            <span class="field-label">Categoria</span>
            <select id="f-cat"></select>
          </div>
          <div class="field">
            <span class="field-label">Parte</span>
            <select id="f-party"></select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-label">ReferÃªncia</div>
        <div class="form-card">
          <div class="field">
            <span class="field-label">Data</span>
            <input id="f-date" type="date">
          </div>
          <div class="field">
            <span class="field-label">Ano Letivo</span>
            <select id="f-year"></select>
          </div>
          <div class="field">
            <span class="field-label">MÃªs</span>
            <select id="f-month">
              <option value="1">Janeiro</option><option value="2">Fevereiro</option>
              <option value="3">MarÃ§o</option><option value="4">Abril</option>
              <option value="5">Maio</option><option value="6">Junho</option>
              <option value="7">Julho</option><option value="8">Agosto</option>
              <option value="9">Setembro</option><option value="10">Outubro</option>
              <option value="11">Novembro</option><option value="12">Dezembro</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-label">Detalhes</div>
        <div class="form-card">
          <div class="tog-field" onclick="document.getElementById('tog').classList.toggle('on')">
            <span class="tog-label">Recebido apÃ³s dia 5 &nbsp;â– </span>
            <div class="toggle" id="tog"></div>
          </div>
          
          <div class="tog-field" onclick="document.getElementById('tog-forecast').classList.toggle('on')">
            <span class="tog-label">Ã‰ previsÃ£o (futuro)</span>
            <div class="toggle" id="tog-forecast"></div>
          </div>
          <div class="field tall">

            <span class="field-label">Notas</span>
            <textarea id="f-notes" rows="2" placeholder="ObservaÃ§Ãµesâ€¦"></textarea>
          </div>
          <div class="field">
            <span class="field-label">Tags</span>
            <input id="f-tags" type="text" placeholder="opcional">
          </div>
        </div>
      </div>

      <div class="btns">
        <button class="btn primary" onclick="saveTx()">ğŸ’¾&nbsp; Salvar TransaÃ§Ã£o</button>
        <button id="del-btn" class="btn destructive" style="display:none" onclick="deleteTx()">ğŸ—‘&nbsp; Excluir TransaÃ§Ã£o</button>
      </div>
      <div style="height:8px"></div>
    </div>

    <!-- â–‘â–‘ REPORTS â–‘â–‘ -->
    <div class="page" id="page-rpt">
      <div class="pg-title">RelatÃ³rio</div>

      <!-- Action bar â€” hidden during print -->
      <div id="rpt-actions-bar" style="display:flex;gap:8px;padding:12px 20px 4px;flex-wrap:wrap">
        <button class="pill-btn blue" onclick="printReport()">ğŸ–¨ï¸&nbsp; Imprimir / Salvar PDF</button>
        <button class="pill-btn gray" onclick="exportCSV()">ğŸ“¥&nbsp; Exportar CSV</button>
        <button class="pill-btn gray" onclick="exportExcel()">ğŸ“—&nbsp; Exportar Excel</button>
      </div>

      <div id="rpt-content">
        <div class="empty-state"><span class="spinner"></span></div>
      </div>

      <div id="rpt-hint" style="padding:0 20px 16px;font-size:11px;color:var(--t-faint);line-height:1.7">
        <strong style="color:var(--red)">â– </strong>&nbsp;Recebido apÃ³s o dia 5 (atraso)&nbsp;Â·&nbsp;
        Para PDF: Imprimir â†’ <em>Compartilhar</em> â†’ <em>Salvar como PDF</em>
      </div>
    </div>

    <!-- â–‘â–‘ SETTINGS â–‘â–‘ -->
    <div class="page" id="page-cfg">
      <div class="pg-title">ConfiguraÃ§Ãµes</div>

      <div class="form-section">
        <div class="form-label">Backup</div>
        <div class="form-card">
          <div class="list-row" onclick="exportJSON()">
            <div class="list-icon" style="background:var(--accent-l)">ğŸ’¾</div>
            <div class="list-label">Exportar backup JSON</div>
            <div class="list-chevron"><svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
          <div class="list-row" onclick="document.getElementById('imp-file').click()">
            <div class="list-icon" style="background:var(--green-l)">ğŸ“‚</div>
            <div class="list-label">Importar backup JSON</div>
            <input type="file" id="imp-file" accept=".json" style="display:none" onchange="importJSON(event.target.files[0])">
            <div class="list-chevron"><svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
        <div id="imp-msg" style="display:none;margin-top:8px;padding:12px 14px;border-radius:var(--r);font-size:13px;font-weight:500;line-height:1.5"></div>
      </div>

      <div class="form-section">
        <div class="form-label">Categorias</div>
        <div class="form-card" id="cat-list-wrap"></div>
        <div style="margin-top:8px">
          <button class="btn secondary" style="border-radius:var(--r2)" onclick="document.getElementById('cat-sheet').classList.add('open')">+ Nova Categoria</button>
        </div>
      </div>

      
      <div class="form-section">
        <div class="form-label">Partes</div>
        <div class="form-card" id="party-list-wrap"></div>
        <div style="margin-top:8px">
          <button class="btn secondary" style="border-radius:var(--r2)" onclick="document.getElementById('party-sheet').classList.add('open')">+ Nova Parte</button>
        </div>
      </div>

<div class="form-section">
        <div class="form-label">Dados</div>
        <div class="form-card">
          <div class="list-row">
            <div class="list-icon" style="background:var(--accent-l)">ğŸ“Š</div>
            <div class="list-label">Total de transaÃ§Ãµes</div>
            <div class="list-value" id="stat-count">â€”</div>
          </div>
          <div class="list-row">
            <div class="list-icon" style="background:var(--orange-l)">ğŸ“…</div>
            <div class="list-label">Anos com dados</div>
            <div class="list-value" id="stat-years">â€”</div>
          </div>
          <div class="list-row">
            <div class="list-icon" style="background:var(--green-l)">ğŸ“±</div>
            <div class="list-label">Armazenamento</div>
            <div class="list-value">iPhone (local)</div>
          </div>
          <div class="list-row" onclick="clearAll()" style="cursor:pointer">
            <div class="list-icon" style="background:var(--red-l)">âš ï¸</div>
            <div class="list-label" style="color:var(--red)">Apagar todos os dados</div>
            <div class="list-chevron"><svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </div>

      <div class="form-section" style="margin-bottom:20px">
        <div class="form-label">Instalar no iPhone</div>
        <div class="form-card" style="padding:14px 16px">
          <p style="font-size:15px;color:var(--t-body);line-height:2.1">
            1. Abra esta pÃ¡gina no <strong style="color:var(--t-primary)">Safari</strong><br>
            2. Toque em <strong style="color:var(--t-primary)">â¬†ï¸ Compartilhar</strong><br>
            3. Toque em <strong style="color:var(--t-primary)">"Adicionar Ã  Tela de InÃ­cio"</strong><br>
            4. Toque em <strong style="color:var(--t-primary)">Adicionar</strong>
          </p>
        </div>
      </div>

    </div>
  </div><!-- /scroller -->

  <!-- TAB BAR -->
  <div class="tabbar">
    <button class="tab on" id="t-dash" onclick="nav('dash')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>
      InÃ­cio
    </button>
    <button class="tab" id="t-txs" onclick="nav('txs')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="4" cy="6" r="1.5" fill="currentColor" stroke="none"/><circle cx="4" cy="12" r="1.5" fill="currentColor" stroke="none"/><circle cx="4" cy="18" r="1.5" fill="currentColor" stroke="none"/></svg>
      TransaÃ§Ãµes
    </button>
    <button class="tab" id="t-add" onclick="nav('add')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
      Novo
    </button>
    <button class="tab" id="t-rpt" onclick="nav('rpt')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="9" y1="13" x2="15" y2="13"/><line x1="9" y1="17" x2="15" y2="17"/></svg>
      RelatÃ³rio
    </button>
    <button class="tab" id="t-cfg" onclick="nav('cfg')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Config
    </button>
  </div>
</div>

<!-- TX DETAIL SHEET -->
<div class="sheet-bg" id="tx-sheet">
  <div class="sheet">
    <div class="sheet-grip"></div>
    <div class="sheet-hdr">
      <div class="sheet-title" id="sh-title">TransaÃ§Ã£o</div>
      <button class="sheet-close" onclick="document.getElementById('tx-sheet').classList.remove('open')">Fechar</button>
    </div>
    <div id="sh-body"></div>
  </div>
</div>

<!-- NEW CAT SHEET -->
<div class="sheet-bg" id="cat-sheet">
  <div class="sheet">
    <div class="sheet-grip"></div>
    <div class="sheet-hdr">
      <div class="sheet-title">Nova Categoria</div>
      <button class="sheet-close" onclick="document.getElementById('cat-sheet').classList.remove('open')">Cancelar</button>
    </div>
    <div style="padding:16px">
      <div class="form-card">
        <div class="field"><span class="field-label">Chave</span><input id="nc-key" placeholder="ex: excursao"></div>
        <div class="field"><span class="field-label">Nome</span><input id="nc-label" placeholder="ex: ExcursÃ£o"></div>
        <div class="field"><span class="field-label">Cor</span><input id="nc-color" type="color" value="#3B5BDB" style="width:44px;height:30px;border:none;background:none;cursor:pointer;-webkit-appearance:none;padding:0;margin-left:auto"></div>
      </div>
      <div style="margin-top:12px"><button class="btn primary" onclick="saveCat()">Criar Categoria</button></div>
    </div>
  </div>
</div>


<!-- NEW PARTY SHEET -->
<div class="sheet-bg" id="party-sheet">
  <div class="sheet">
    <div class="sheet-grip"></div>
    <div class="sheet-hdr">
      <div class="sheet-title">Nova Parte</div>
      <button class="sheet-close" onclick="document.getElementById('party-sheet').classList.remove('open')">Cancelar</button>
    </div>
    <div style="padding:16px">
      <div class="form-card">
        <div class="field"><span class="field-label">Chave</span><input id="np-key" placeholder="ex: avo"></div>
        <div class="field"><span class="field-label">Nome</span><input id="np-label" placeholder="ex: AvÃ³"></div>
      </div>
      <div style="margin-top:12px"><button class="btn primary" onclick="saveParty()">Criar Parte</button></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script type="module" src="./app/main.js"></script>

</body>
</html>
